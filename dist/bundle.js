!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.loggle=t():e.loggle=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{LOG_LEVELS:()=>i,createLogger:()=>u});const r=e=>"function"==typeof e,a=(e,t)=>{const r=Object.entries(e).map((([e,r])=>t(e,r)));return Object.fromEntries(r)},n=e=>r(e)?e:()=>e,o=e=>!Array.isArray(e)&&"object"==typeof e&&null!==e,s=e=>{return t=Object.keys(e),r=t=>o(e[t])?{[t]:!0,...s(e[t])}:{[t]:!0},t.reduce(((e,t)=>({...e,...r(t)})),{});var t,r},i={critical:0,error:1,warn:2,info:3,debug:4},l={enabled:!0,level:"info",formatLogSegments:e=>e.join(" "),prefix:{includeLevelName:!0,includeTime:!0,getCurrentTimeString:()=>(new Date).toLocaleTimeString("en-US",{hour12:!1}),format:e=>`[${e.join(" ")}]`,colors:{critical:"red",error:"orange",warn:"yellow",info:"skyblue",debug:"lightgreen"}},sink:{endpoint:null,func:({message:{asSegments:e,asString:t},metadata:r})=>{console.log(...e)},aggregateTabs:!1},metadata:()=>({clientTimestamp:Date.now()}),replaceParentConfig:!1,replaceParentMetadata:!1,filter:({message:{asSegments:e,asString:t},metadata:r})=>!0,async:!1},c=(()=>{const e=s(l);return t=>o(t)&&Object.keys(t).every((t=>e.hasOwnProperty(t)))})(),g=(e,t)=>{if(t.replaceParentConfig)return t;if(t.replaceParentMetadata&&e.metadata)return g({...e,metadata:null},t);const r=[e.metadata,t.metadata];if(r.every((e=>e))){const a=r.map(n);return g({...e,metadata:null},{...t,metadata:a})}return a(e,((r,a)=>c(e[r])&&c(t[r])?[r,g(e[r],t[r])]:[r,t.hasOwnProperty(r)?t[r]:a]))},d=(e,t,r)=>{if(!t.prefix)return[];const a=[t.prefix.includeLevelName&&e,t.prefix.includeTime&&t.prefix.getCurrentTimeString()].filter((e=>e)),n=(r?"%c":"")+t.prefix.format(a),o=r?`color: ${t.prefix.colors[e]};`:"";return o?[n,o]:[n]},f=(e,t,r,a)=>[...d(t,r,a),...e].filter((e=>e));let m=null;const u=(e=l)=>{const t=g(l,e);return{...a(i,((e,a)=>{return[e,(n=e,o=a,(...e)=>{try{const l=c(e[0]),d=l?g(t,e[0]):t,u=l?e.slice(1):e;if(!d.enabled||o>("number"==typeof(s=d.level)?s:i[s]))return;const p={...Array.isArray(d.metadata)?d.metadata.reduce(((e,t)=>Object.assign(e,t())),{}):(a=d.metadata,r(a)?a():a),level:n},y=f(u,n,d,!!d.prefix.colors),b=d.formatLogSegments(y);if(!d.filter({message:{asString:b,asSegments:y},metadata:p}))return;if(d.sink.func&&d.sink.func({message:{asString:b,asSegments:y},metadata:p}),d.sink.endpoint){const e=f(u,n,d,!1);(async(e="",t={})=>{try{(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},keepalive:!0,body:JSON.stringify(t)})).json()}catch(e){console.log("An error occurred during POST to the log sink endpoint: ",e)}})(d.sink.endpoint,{message:{asString:d.formatLogSegments(e),asSegments:e},metadata:p})}d.sink.aggregateTabs?"BroadcastChannel"in window?(m||(m=new BroadcastChannel("_loggle_aggregated_tab_logs"),m.addEventListener("message",(e=>{"log"===e.data.type&&console.log(...e.data.args.map((e=>(e=>{try{return JSON.parse(e)}catch(t){return e}})(e))))}))),m.postMessage({type:"log",args:y.map((e=>"object"==typeof e?JSON.stringify(e):e))})):console.log("BroadcastChannel not supported in this browser. Disabling tab log aggregation."):m&&(m.close(),m=null)}catch{console.error("An error occurred during log execution. Args:",...e)}var a,s})];var n,o})),createSubLogger:e=>u(g(t,e))}};return t})()));